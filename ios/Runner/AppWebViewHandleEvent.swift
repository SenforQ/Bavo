
//: Declare String Begin

/*: "typeName" :*/
fileprivate let const_itemData:[UInt8] = [0xaa,0xa7,0xae,0xbb,0x90,0xbf,0xb3,0xbb]

private func freezeClick(action num: UInt8) -> UInt8 {
    return num ^ 222
}

/*: "deviceID" :*/
fileprivate let const_regionTagData_:[UInt8] = [0x90,0x91,0x82,0x9d,0x97,0x91,0xbd,0xb0]

private func boundPerspective(path num: UInt8) -> UInt8 {
    return num ^ 244
}

/*: "fireBaseID" :*/
fileprivate let constTransformPalm:[UInt8] = [0x11,0x14,0x1d,0x10,0xed,0xc,0x1e,0x10,0xf4,0xef]

fileprivate func pathFalse(background num: UInt8) -> UInt8 {
    let value = Int(num) - 171
    if value < 0 {
        return UInt8(value + 256)
    } else {
        return UInt8(value)
    }
}

/*: "areaISO" :*/
fileprivate let data_topicPalmMain_:[UInt8] = [0x7,0x14,0x3,0x7,0x2f,0x35,0x29]

private func displayPresent(current num: UInt8) -> UInt8 {
    return num ^ 102
}

/*: "isProxy" :*/
fileprivate let const_launchUser:[UInt8] = [0xda,0xe4,0xc1,0xe3,0xe0,0xe9,0xea]

fileprivate func cutDown(device num: UInt8) -> UInt8 {
    let value = Int(num) + 143
    if value > 255 {
        return UInt8(value - 256)
    } else {
        return UInt8(value)
    }
}

/*: "langCode" :*/
fileprivate let constLogFailNoti_:[UInt8] = [0x65,0x64,0x6f,0x43,0x67,0x6e,0x61,0x6c]

/*: "timeZone" :*/
fileprivate let constPageMain_:[UInt8] = [0x3f,0x22,0x26,0x2e,0x11,0x24,0x25,0x2e]

private func sourceLabel(level num: UInt8) -> UInt8 {
    return num ^ 75
}

/*: "installedApps" :*/
fileprivate let kCanConst_:[UInt8] = [0xe4,0xe3,0xfe,0xf9,0xec,0xe1,0xe1,0xe8,0xe9,0xcc,0xfd,0xfd,0xfe]

private func presentDoing(rating num: UInt8) -> UInt8 {
    return num ^ 141
}

/*: "systemUUID" :*/
fileprivate let mainTakeConst:[UInt8] = [0x2d,0x27,0x2d,0x2a,0x3b,0x33,0xb,0xb,0x17,0x1a]

private func effectNeed(observer num: UInt8) -> UInt8 {
    return num ^ 94
}

/*: "countryCode" :*/
fileprivate let dataTransformPresentShow_:[UInt8] = [0x25,0x31,0x37,0x30,0x36,0x34,0x3b,0x5,0x31,0x26,0x27]

fileprivate func phonePassing(info num: UInt8) -> UInt8 {
    let value = Int(num) + 62
    if value > 255 {
        return UInt8(value - 256)
    } else {
        return UInt8(value)
    }
}

/*: "status" :*/
fileprivate let mainWindowNoti:[UInt8] = [0x40,0x47,0x52,0x47,0x46,0x40]

private func mirrorPull(near num: UInt8) -> UInt8 {
    return num ^ 51
}

/*: "isAuth" :*/
fileprivate let app_forwardData_:[UInt8] = [0xe9,0xf3,0xc1,0xf5,0xf4,0xe8]

private func chanceFailure(field num: UInt8) -> UInt8 {
    return num ^ 128
}

/*: "isFirst" :*/
fileprivate let constReceiveNoti_:[UInt8] = [0x1e,0x4,0x31,0x1e,0x5,0x4,0x3]

private func confirmName(add num: UInt8) -> UInt8 {
    return num ^ 119
}

/*: __LocalPush" :*/
fileprivate let app_messageConst:String = "__Locaconfirm rating white"

/*: "identifier" :*/
fileprivate let data_fadeEventMain_:[UInt8] = [0x72,0x65,0x69,0x66,0x69,0x74,0x6e,0x65,0x64,0x69]

/*: "HTTPProxy" :*/
fileprivate let noti_yourConst:String = "HTTPProprogress option above consider sale"
fileprivate let const_willNear:[Character] = ["x","y"]

/*: "HTTPSProxy" :*/
fileprivate let const_milkPresentNoti:String = "aboveTTP"
fileprivate let data_contactAddPermissionNoti:[Character] = ["x","y"]

/*: "SOCKSProxy" :*/
fileprivate let notiOkMain:String = "language"
fileprivate let show_clickPullData_:String = "ocks"

/*: "__SCOPED__" :*/
fileprivate let user_topMain:String = "voicevoice"
fileprivate let show_cameraTargetUser_:String = "empty homeSCOPED__"

/*: "tap" :*/
fileprivate let mainReceiverUser_:[Character] = ["t","a","p"]

/*: "tun" :*/
fileprivate let k_teamUser:String = "sendun"

/*: "ipsec" :*/
fileprivate let showCountDisplaySound:[Character] = ["i","p","s","e","c"]

/*: "ppp" :*/
fileprivate let showKitUser_:String = "methodmethodmethod"

/*: "Retry After or Go to " :*/
fileprivate let showRegionData_:[Character] = ["R","e","t","r","y"," ","A","f","t","e","r"," ","o","r"," ","G","o"," "]
fileprivate let app_indexMediaUser_:[Character] = ["t","o"," "]

/*: "Feedback" :*/
fileprivate let k_activeShow:[Character] = ["F","e","e","d","b","a","c","k"]

/*: " to contact us" :*/
fileprivate let notiVoiceRemoveMain_:[Character] = [" ","t","o"," ","c","o","n","t","a"]
fileprivate let kMakeNoti_:String = "black target process removect us"

//: Declare String End

// __DEBUG__
// __CLOSE_PRINT__
//
//  AppWebViewHandleEvent.swift
//  OverseaH5
//
//  Created by young on 2025/9/23.
//

//: import CoreTelephony
import CoreTelephony
//: import FirebaseMessaging
import FirebaseMessaging
//: import HandyJSON
import HandyJSON
//: import StoreKit
import StoreKit
//: import UIKit
import UIKit

//: enum TypeName: String, HandyJSONEnum {
enum SecurityTextProtocol: String, HandyJSONEnum {
    //: case unDefaultMethod = "unDefaultMethod"    // 未定义方法
    case unDefaultMethod // 未定义方法
    //: case getDeviceID     = "getDeviceID"        // 获取设备号
    case getDeviceID // 获取设备号
    //: case getFireBaseID   = "getFirebaseID"      // 获取FireBaseToken
    case getFireBaseID = "getFirebaseID" // 获取FireBaseToken
    //: case getAreaISO      = "getAreaISO"         // 获取 SIM/运营商 地区ISO
    case getAreaISO // 获取 SIM/运营商 地区ISO
    //: case getProxyStatus  = "getProxyStatus"     // 获取是否使用了代理
    case getProxyStatus // 获取是否使用了代理
    //: case getMicStatus    = "getMicStatus"       // 获取麦克风权限
    case getMicStatus // 获取麦克风权限
    //: case getPhotoStatus  = "getPhotoStatus"     // 获取相册权限
    case getPhotoStatus // 获取相册权限
    //: case getCameraStatus = "getCameraStatus"    // 获取相机权限
    case getCameraStatus // 获取相机权限
    //: case reportAdjust    = "reportAdjust"       // 上报Adjust
    case reportAdjust // 上报Adjust
    //: case requestLocalPush = "requestLocalPush"  // APP在后台收到音视频通话推送
    case requestLocalPush // APP在后台收到音视频通话推送
    // 新增协议
    //: case getLangCode      = "getLangCode"        // 获取系统语言
    case getLangCode // 获取系统语言
    //: case getTimeZone      = "getTimeZone"        // 获取当前系统时区
    case getTimeZone // 获取当前系统时区
    //: case getInstalledApps = "getInstalledApps"   // 获取已安装应用列表
    case getInstalledApps // 获取已安装应用列表
    //: case getSystemUUID    = "getSystemUUID"      // 获取系统UUID
    case getSystemUUID // 获取系统UUID
    //: case getCountryCode   = "getCountryCode"     // 获取当前系统地区
    case getCountryCode // 获取当前系统地区
    //: case inAppRating      = "inAppRating"        // 应用内评分
    case inAppRating // 应用内评分
    //: case apPay            = "apPay"              // 苹果支付
    case apPay // 苹果支付
    //: case subscribe        = "subscribe"          // 苹果支付-订阅
    case subscribe // 苹果支付-订阅
    //: case openSystemBrowser = "openSystemBrowser" // 调用系统浏览器打开url
    case openSystemBrowser // 调用系统浏览器打开url
    //: case closeWebview     = "closeWebview"       // 关闭当前webview
    case closeWebview // 关闭当前webview
    //: case openNewWebview   = "openNewWebview"     // 使用新webview打开url
    case openNewWebview // 使用新webview打开url
}

//: struct JSMessageModel: HandyJSON {
struct CompositionHandyJSON: HandyJSON {
    //: var typeName: TypeName = .unDefaultMethod
    var typeName: SecurityTextProtocol = .unDefaultMethod
    //: var token: String?
    var token: String?
    //: var totalCount: Double?
    var totalCount: Double?

    //: var showText: String?
    var showText: String?
    //: var data: UserInfoModel?
    var data: HypothesisMeasurable?
    // 内购/订阅 H5参数
    //: var goodsId: String?
    var goodsId: String? // 商品Id
    //: var source: Int?
    var source: Int? // 充值来源
    //: var type: Int?
    var type: Int? // 订阅入口；1：首页banner，2：全屏充值页，3：半屏充值页，4：领取金币弹窗
    //: var url: String?
    var url: String? // url
    //: var fullscreen: Int?
    var fullscreen: Int? // fullscreen：0:页面从状态栏以下渲染 1:全屏
    //: var transparency: Int?
    var transparency: Int? // transparency：0-webview白色背景 1-webview透明背景
}

//: struct UserInfoModel: HandyJSON {
struct HypothesisMeasurable: HandyJSON {
    //: var headPic: String?
    var headPic: String? // 头像
    //: var nickname: String?
    var nickname: String? // 昵称
    //: var uid: String?
    var uid: String? // 用户Id
}

//: extension AppWebViewController {
extension AntiLiteralViewController {
    //: func handleH5Message(schemeDic: [String: Any], callBack: @escaping (_ backDic: [String: Any]) -> Void) {
    func extentOf(schemeDic: [String: Any], callBack: @escaping (_ backDic: [String: Any]) -> Void) {
        //: if let model = JSMessageModel.deserialize(from: schemeDic) {
        if let model = CompositionHandyJSON.deserialize(from: schemeDic) {
            //: switch model.typeName {
            switch model.typeName {
            //: case .getDeviceID:
            case .getDeviceID:
                //: let adidStr = AppAdjustManager.getAdjustAdid()
                let adidStr = ValidAdjustManager.target()
                //: callBack(["typeName": model.typeName.rawValue, "deviceID": adidStr])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: const_regionTagData_.map{boundPerspective(path: $0)}, encoding: .utf8)!: adidStr])

            //: case .getFireBaseID:
            case .getFireBaseID:
                //: AppWebViewController.getFireBaseToken { str in
                AntiLiteralViewController.boundary { str in
                    //: callBack(["typeName": model.typeName.rawValue, "fireBaseID": str])
                    callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: constTransformPalm.map{pathFalse(background: $0)}, encoding: .utf8)!: str])
                }

            //: case .getAreaISO:
            case .getAreaISO:
                //: let arr = AppWebViewController.getCountryISOCode()
                let arr = AntiLiteralViewController.codification()
                //: callBack(["typeName": model.typeName.rawValue, "areaISO": arr.joined(separator: ",")])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: data_topicPalmMain_.map{displayPresent(current: $0)}, encoding: .utf8)!: arr.joined(separator: ",")])

            //: case .getProxyStatus:
            case .getProxyStatus:
                //: let status = AppWebViewController.getUsedProxyStatus()
                let status = AntiLiteralViewController.street()
                //: callBack(["typeName": model.typeName.rawValue, "isProxy": status])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: const_launchUser.map{cutDown(device: $0)}, encoding: .utf8)!: status])

            //: case .getLangCode:
            case .getLangCode:
                //: let langCode = UIDevice.langCode
                let langCode = UIDevice.langCode
                //: callBack(["typeName": model.typeName.rawValue, "langCode": langCode])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: constLogFailNoti_.reversed(), encoding: .utf8)!: langCode])

            //: case .getTimeZone:
            case .getTimeZone:
                //: let timeZone = UIDevice.timeZone
                let timeZone = UIDevice.timeZone
                //: callBack(["typeName": model.typeName.rawValue, "timeZone": timeZone])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: constPageMain_.map{sourceLabel(level: $0)}, encoding: .utf8)!: timeZone])

            //: case .getInstalledApps:
            case .getInstalledApps:
                //: let apps = UIDevice.getInstalledApps
                let apps = UIDevice.getInstalledApps
                //: callBack(["typeName": model.typeName.rawValue, "installedApps": apps])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: kCanConst_.map{presentDoing(rating: $0)}, encoding: .utf8)!: apps])

            //: case .getSystemUUID:
            case .getSystemUUID:
                //: let uuid = UIDevice.systemUUID
                let uuid = UIDevice.systemUUID
                //: callBack(["typeName": model.typeName.rawValue, "systemUUID": uuid])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: mainTakeConst.map{effectNeed(observer: $0)}, encoding: .utf8)!: uuid])

            //: case .getCountryCode:
            case .getCountryCode:
                //: let countryCode = UIDevice.countryCode
                let countryCode = UIDevice.countryCode
                //: callBack(["typeName": model.typeName.rawValue, "countryCode": countryCode])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: dataTransformPresentShow_.map{phonePassing(info: $0)}, encoding: .utf8)!: countryCode])

            //: case .inAppRating:
            case .inAppRating:
                //: callBack(["typeName": model.typeName.rawValue])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue])
                //: AppWebViewController.requestInAppRating()
                AntiLiteralViewController.creationRating()

            //: case .apPay:
            case .apPay:
                //: if let goodsId = model.goodsId, let source = model.source {
                if let goodsId = model.goodsId, let source = model.source {
                    //: self.applePay(productId: goodsId, source: source, payType: .Pay) { success in
                    self.stack(productId: goodsId, source: source, payType: .Pay) { success in
                        //: callBack(["typeName": model.typeName.rawValue, "status": success])
                        callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: mainWindowNoti.map{mirrorPull(near: $0)}, encoding: .utf8)!: success])
                    }
                }

            //: case .subscribe:
            case .subscribe:
                //: if let goodsId = model.goodsId {
                if let goodsId = model.goodsId {
                    //: self.applePay(productId: goodsId, payType: .Subscribe) { success in
                    self.stack(productId: goodsId, payType: .Subscribe) { success in
                        //: callBack(["typeName": model.typeName.rawValue, "status": success])
                        callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: mainWindowNoti.map{mirrorPull(near: $0)}, encoding: .utf8)!: success])
                    }
                }

            //: case .openSystemBrowser:
            case .openSystemBrowser:
                //: callBack(["typeName": model.typeName.rawValue])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue])
                //: if let urlStr = model.url, let openURL = URL(string: urlStr) {
                if let urlStr = model.url, let openURL = URL(string: urlStr) {
                    //: UIApplication.shared.open(openURL, options: [:], completionHandler: nil)
                    UIApplication.shared.open(openURL, options: [:], completionHandler: nil)
                }

            //: case .closeWebview:
            case .closeWebview:
                //: callBack(["typeName": model.typeName.rawValue])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue])
                //: self.closeWeb()
                self.just()

            //: case .openNewWebview:
            case .openNewWebview:
                //: callBack(["typeName": model.typeName.rawValue])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue])
                //: if let urlStr = model.url, let transparency = model.transparency {
                if let urlStr = model.url,
                    let transparency = model.transparency,
                    let fullscreen = model.fullscreen {
                    //: AppWebViewController.openNewWebView(urlStr, transparency)
                    AntiLiteralViewController.regulate(urlStr, transparency, fullscreen)
                }

            //: case .getMicStatus:
            case .getMicStatus:
                //: AppPermissionTool.shared.requestMicPermission { auth, isFirst in
                StricklePermissionTool.shared.fade { auth, isFirst in
                    //: callBack(["typeName": model.typeName.rawValue, "isAuth": auth, "isFirst": isFirst])
                    callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: app_forwardData_.map{chanceFailure(field: $0)}, encoding: .utf8)!: auth, String(bytes: constReceiveNoti_.map{confirmName(add: $0)}, encoding: .utf8)!: isFirst])
                }

            //: case .getPhotoStatus:
            case .getPhotoStatus:
                //: AppPermissionTool.shared.requestPhotoPermission { auth, isFirst in
                StricklePermissionTool.shared.kick { auth, isFirst in
                    //: callBack(["typeName": model.typeName.rawValue, "isAuth": auth, "isFirst": isFirst])
                    callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: app_forwardData_.map{chanceFailure(field: $0)}, encoding: .utf8)!: auth, String(bytes: constReceiveNoti_.map{confirmName(add: $0)}, encoding: .utf8)!: isFirst])
                }

            //: case .getCameraStatus:
            case .getCameraStatus:
                //: AppPermissionTool.shared.requestCameraPermission { auth, isFirst in
                StricklePermissionTool.shared.past { auth, isFirst in
                    //: callBack(["typeName": model.typeName.rawValue, "isAuth": auth, "isFirst": isFirst])
                    callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue, String(bytes: app_forwardData_.map{chanceFailure(field: $0)}, encoding: .utf8)!: auth, String(bytes: constReceiveNoti_.map{confirmName(add: $0)}, encoding: .utf8)!: isFirst])
                }

            //: case .reportAdjust:
            case .reportAdjust:
                //: if let token = model.token {
                if let token = model.token {
                    //: if let count = model.totalCount {
                    if let count = model.totalCount {
                        //: AppAdjustManager.addPurchasedEvent(token: token, count: count)
                        ValidAdjustManager.nearAll(token: token, count: count)
                        //: } else {
                    } else {
                        //: AppAdjustManager.addEvent(token: token)
                        ValidAdjustManager.add(token: token)
                    }
                }
                //: callBack(["typeName": model.typeName.rawValue])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue])

            //: case .requestLocalPush:
            case .requestLocalPush:
                //: callBack(["typeName": model.typeName.rawValue])
                callBack([String(bytes: const_itemData.map{freezeClick(action: $0)}, encoding: .utf8)!: model.typeName.rawValue])
                //: AppWebViewController.pushLocalNotification(model)
                AntiLiteralViewController.concatenation(model)

            //: default: break
            default: break
            }
        }
    }
}

// MARK: - Event

//: extension AppWebViewController {
extension AntiLiteralViewController {
    /// 打开新的webview
    /// - Parameters:
    ///   - urlStr: web地址
    ///   - transparency: 0：白色背景 1：透明背景
    //: class func openNewWebView(_ urlStr: String, _ transparency: Int = 0) {
    class func regulate(_ urlStr: String, _ transparency: Int = 0, _ fullscreen: Int = 1) {
        //: let vc = AppWebViewController()
        let vc = AntiLiteralViewController()
        //: vc.urlString = urlStr
        vc.urlString = urlStr
        //: vc.clearBgColor = (transparency == 1)
        vc.clearBgColor = (transparency == 1)
        vc.fullscreen = (fullscreen == 1)
        //: vc.modalPresentationStyle = .fullScreen
        vc.modalPresentationStyle = .fullScreen
        //: AppConfig.currentViewController()?.present(vc, animated: true)
        MainAppConfig.basic()?.present(vc, animated: true)
    }

    /// 本地推送
    //: class func pushLocalNotification(_ model: JSMessageModel) {
    class func concatenation(_ model: CompositionHandyJSON) {
        //: guard UIApplication.shared.applicationState != .active else { return }
        guard UIApplication.shared.applicationState != .active else { return }
        //: UNUserNotificationCenter.current().getNotificationSettings { setting in
        UNUserNotificationCenter.current().getNotificationSettings { setting in
            //: switch setting.authorizationStatus {
            switch setting.authorizationStatus {
            //: case .notDetermined, .denied, .ephemeral:
            case .notDetermined, .denied, .ephemeral:
                //: print("本地推送通知 -- 用户未授权\(setting.authorizationStatus)")
                //: print()
                print()

            //: case .provisional, .authorized:
            case .provisional, .authorized:
                //: if let dataModel = model.data {
                if let dataModel = model.data {
                    //: let content = UNMutableNotificationContent()
                    let content = UNMutableNotificationContent()
                    //: content.title = dataModel.nickname ?? ""
                    content.title = dataModel.nickname ?? ""
                    //: content.body = model.showText ?? ""
                    content.body = model.showText ?? ""
                    //: let identifier = dataModel.uid ?? "\(AppName)__LocalPush"
                    let identifier = dataModel.uid ?? "\(noti_cornerIndexReceiverShow_)" + (String(app_messageConst.prefix(6)) + "lPush")
                    //: content.userInfo = ["identifier": identifier]
                    content.userInfo = [String(bytes: data_fadeEventMain_.reversed(), encoding: .utf8)!: identifier]
                    //: content.sound = UNNotificationSound.default
                    content.sound = UNNotificationSound.default

                    //: let time = Date(timeIntervalSinceNow: 1).timeIntervalSinceNow
                    let time = Date(timeIntervalSinceNow: 1).timeIntervalSinceNow
                    //: let trigger = UNTimeIntervalNotificationTrigger(timeInterval: time, repeats: false)
                    let trigger = UNTimeIntervalNotificationTrigger(timeInterval: time, repeats: false)
                    //: let request = UNNotificationRequest(identifier: identifier, content: content, trigger: trigger)
                    let request = UNNotificationRequest(identifier: identifier, content: content, trigger: trigger)
                    //: UNUserNotificationCenter.current().add(request) { _ in
                    UNUserNotificationCenter.current().add(request) { _ in
                    }
                }

            //: @unknown default: break
            @unknown default: break
                //: print("本地推送通知 -- 用户未授权\(setting.authorizationStatus)")
            }
        }
    }

    /// 获取firebase token
    //: class func getFireBaseToken(tokenBlock: @escaping (_ str: String) -> Void) {
    class func boundary(tokenBlock: @escaping (_ str: String) -> Void) {
        //: Messaging.messaging().token { token, _ in
        Messaging.messaging().token { token, _ in
            //: if let token = token {
            if let token = token {
                //: tokenBlock(token)
                tokenBlock(token)
                //: } else {
            } else {
                //: tokenBlock("")
                tokenBlock("")
            }
        }
    }

    /// 获取ISO国家代码
    //: class func getCountryISOCode() -> [String] {
    class func codification() -> [String] {
        //: var tempArr: [String] = []
        var tempArr: [String] = []
        //: let info = CTTelephonyNetworkInfo()
        let info = CTTelephonyNetworkInfo()
        //: if let carrierDic = info.serviceSubscriberCellularProviders {
        if let carrierDic = info.serviceSubscriberCellularProviders {
            //: if !carrierDic.isEmpty {
            if !carrierDic.isEmpty {
                //: for carrier in carrierDic.values {
                for carrier in carrierDic.values {
                    //: if let iso = carrier.isoCountryCode, !iso.isEmpty {
                    if let iso = carrier.isoCountryCode, !iso.isEmpty {
                        //: tempArr.append(iso)
                        tempArr.append(iso)
                    }
                }
            }
        }
        //: return tempArr
        return tempArr
    }

    /// 获取用户代理状态
    //: class func getUsedProxyStatus() -> Bool {
    class func street() -> Bool {
        //: if AppWebViewController.isUsedProxy() || AppWebViewController.isUsedVPN() {
        if AntiLiteralViewController.perspectiveFrameProxy() || AntiLiteralViewController.home() {
            //: return true
            return true
        }
        //: return false
        return false
    }

    /// 判断用户设备是否开启代理
    /// - Returns: false: 未开启  true: 开启
    //: class func isUsedProxy() -> Bool {
    class func perspectiveFrameProxy() -> Bool {
        //: guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
        guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
        //: guard let dict = proxy as? [String: Any] else { return false }
        guard let dict = proxy as? [String: Any] else { return false }

        //: if let httpProxy = dict["HTTPProxy"] as? String, !httpProxy.isEmpty { return true }
        if let httpProxy = dict[(String(noti_yourConst.prefix(7)) + String(const_willNear))] as? String, !httpProxy.isEmpty { return true }
        //: if let httpsProxy = dict["HTTPSProxy"] as? String, !httpsProxy.isEmpty { return true }
        if let httpsProxy = dict[(const_milkPresentNoti.replacingOccurrences(of: "above", with: "H") + "SPro" + String(data_contactAddPermissionNoti))] as? String, !httpsProxy.isEmpty { return true }
        //: if let socksProxy = dict["SOCKSProxy"] as? String, !socksProxy.isEmpty { return true }
        if let socksProxy = dict[(notiOkMain.replacingOccurrences(of: "language", with: "S") + show_clickPullData_.uppercased() + "Proxy")] as? String, !socksProxy.isEmpty { return true }

        //: return false
        return false
    }

    /// 判断用户设备是否开启代理VPN
    /// - Returns: false: 未开启  true: 开启
    //: class func isUsedVPN() -> Bool {
    class func home() -> Bool {
        //: guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
        guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
        //: guard let dict = proxy as? [String: Any] else { return false }
        guard let dict = proxy as? [String: Any] else { return false }
        //: guard let scopedDic = dict["__SCOPED__"] as? [String: Any] else { return false }
        guard let scopedDic = dict[(user_topMain.replacingOccurrences(of: "voice", with: "_") + String(show_cameraTargetUser_.suffix(8)))] as? [String: Any] else { return false }
        //: for keyStr in scopedDic.keys {
        for keyStr in scopedDic.keys {
            //: if keyStr.contains("tap") || keyStr.contains("tun") || keyStr.contains("ipsec") || keyStr.contains("ppp"){
            if keyStr.contains((String(mainReceiverUser_))) || keyStr.contains((k_teamUser.replacingOccurrences(of: "send", with: "t"))) || keyStr.contains((String(showCountDisplaySound))) || keyStr.contains((showKitUser_.replacingOccurrences(of: "method", with: "p"))) {
                //: return true
                return true
            }
        }
        //: return false
        return false
    }

    /// 请求应用内评分 - iOS 13+ 优化版本
    //: class func requestInAppRating() {
    class func creationRating() {
        //: if #available(iOS 14.0, *) {
        if #available(iOS 14.0, *) {
            // iOS 14+ 使用新的 WindowScene API（推荐）
            //: if let windowScene = UIApplication.shared.connectedScenes.first as? UIWindowScene {
            if let windowScene = UIApplication.shared.connectedScenes.first as? UIWindowScene {
                //: SKStoreReviewController.requestReview(in: windowScene)
                SKStoreReviewController.requestReview(in: windowScene)
            }
            //: } else {
        } else {
            // iOS 13.x 使用传统 API
            //: SKStoreReviewController.requestReview()
            SKStoreReviewController.requestReview()
        }
    }

    // MARK: - Event

    /// 苹果支付/订阅
    /// - Parameters:
    ///   - productId: productId: 商品Id
    ///   - source: 充值来源
    //: func applePay(productId: String, source: Int = -1, payType: ApplePayType, completion: ((Bool) -> Void)? = nil) {
    func stack(productId: String, source: Int = -1, payType: StrikeType, completion: ((Bool) -> Void)? = nil) {
        //: ProgressHUD.show()
        WaitProgressHUD.hidden()
        //: var index = 0
        var index = 0
        //: if source != -1 {
        if source != -1 {
            //: index = source
            index = source
        }
        //: AppleIAPManager.shared.iap_startPurchase(productId: productId, payType: payType, source: index) { status, _, _ in
        ReceiverManager.shared.without(productId: productId, payType: payType, source: index) { status, _, _ in
            //: ProgressHUD.dismiss()
            WaitProgressHUD.turnStreet()
            //: DispatchQueue.main.async {
            DispatchQueue.main.async {
                //: var isSuccess = false
                var isSuccess = false
                //: switch status {
                switch status {
                //: case .verityFail:
                case .verityFail:
                    //: ProgressHUD.toast( "Retry After or Go to \"Feedback\" to contact us")
                    WaitProgressHUD.previous((String(showRegionData_) + String(app_indexMediaUser_)) + "\"" + (String(k_activeShow)) + "\"" + (String(notiVoiceRemoveMain_) + String(kMakeNoti_.suffix(5))))

                //: case .veritySucceed, .renewSucceed:
                case .veritySucceed, .renewSucceed:
                    //: isSuccess = true
                    isSuccess = true
                    //: self.third_jsEvent_refreshCoin()
                    self.memberOccurrentFreeze()

                //: default: break
                default: break
                    //: print(" apple支付充值失败：\(status.rawValue)")
                }
                //: completion?(isSuccess)
                completion?(isSuccess)
            }
        }
    }
}
